# WeatherPipeline
![avatar](/image/weather_avatar.jpg)

### üöÄ –û –ø—Ä–æ–µ–∫—Ç–µ  
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö –≤ —Å–∞–º—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö –†–æ—Å—Å–∏–∏.  
–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö ‚Äî WeatherAPI, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–≥–æ–¥–µ.  
–ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–æ—â—å—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Apache Airflow, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.  

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞  
```
.
‚îú‚îÄ‚îÄ core/                # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
‚îú‚îÄ‚îÄ dags/                # DAG.
‚îú‚îÄ‚îÄ image/               # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
‚îú‚îÄ‚îÄ.gitignore/           # –§–∞–π–ª—ã, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ Git-–æ–º.
‚îú‚îÄ‚îÄ docker-compose.yaml/ # –°–µ—Ä–≤–∏—Å—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞.
‚îú‚îÄ‚îÄ Dockerfile/          # –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å–±–æ—Ä–∫–∞.
‚îú‚îÄ‚îÄ README.md/           # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ.
‚îú‚îÄ‚îÄ req.txt/             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.
‚îî‚îÄ‚îÄ init.sh              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞.
```

### ‚¨áÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
–ó–∞–ø—É—Å–∫–∞–µ–º **bash-—Å–∫—Ä–∏–ø—Ç** ‚Äî –æ–Ω —Å–æ–∑–¥–∞—Å—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞.
~~~  
./setup_venv.sh
~~~

### üÜò –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –æ—à–∏–±–∫–∏)  
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:  
```  
# UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Airflow  
UID=5000  
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL  
POSTGRES_USER=airflow  
POSTGRES_PASSWORD=airflow  
POSTGRES_DB=airflow  
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏ –¥–ª—è Airflow:  
project_root/  
‚îú‚îÄ‚îÄ dags/  
‚îú‚îÄ‚îÄ logs/  
‚îú‚îÄ‚îÄ plugins/  
‚îî‚îÄ‚îÄ config/  
–≠—Ç–∏ –ø–∞–ø–∫–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã Airflow.  
```

### üß© –ü–æ–¥–Ω–∏–º–∞–µ–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
~~~
docker-compose -p weather_pipeline up -d
~~~

### üìÇ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
#### üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `airflow`
```
Postgres:
  POSTGRES_USER: airflow
  POSTGRES_PASSWORD: airflow
  POSTGRES_DB: airflow
  ports:
    - 5422:5432
```
–°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–∏–≤ —Å–∫—Ä–∏–ø—Ç:  
üìÑ[DatabaseInit](/core/sql_scripts/database_init.sql)

#### üå¶Ô∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö weather
```
postgres:
  POSTGRES_USER: airflow
  POSTGRES_PASSWORD: airflow
  POSTGRES_DB: weather
  ports:
    - 5422:5432
```
–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü:  
üìÑ[TableInit](/core/sql_scripts/table_init.sql)

### üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ –≤ Airflow
–°–æ–∑–¥–∞—ë–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ **Airflow UI**:
- **Connection ID**: `http_conn_id`  
- **Connection Type**: `HTTP`  
- **Host**: `http://api.weatherapi.com/v1/current.json`  
- **Extra**:
  ```json
  {
    "api_token": "cbffd28e42404578a90182057252606"
  }

–°–æ–∑–¥–∞—ë–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ **Airflow UI**:  
-   **Connection ID**: `weather_conn`  
-   **Connection Type**: `Postgres`  
-  **Host**: postgres  
-  **Database**: weather  
-  **Login**: airflow  
-  **Pass**: airflow  
-  **Port**: 5432  

### üîå –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã  
üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)  

    services: postgres_db
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: postgres
    POSTGRES_DB: sprint_etl_db
    ports (–ª–æ–∫–∞–ª—å–Ω—ã–π ‚Üí –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä): 5422:5432 

üåê Airflow Web UI  

    User: airflow
    Pass: airflow
    ports (–ª–æ–∫–∞–ª—å–Ω—ã–π ‚Üí –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä): 8080:8080


